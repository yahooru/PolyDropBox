"use strict";(()=>{var e={};e.id=356,e.ids=[356],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},32694:e=>{e.exports=require("http2")},35240:e=>{e.exports=require("https")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},76162:e=>{e.exports=require("stream")},74175:e=>{e.exports=require("tty")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},6005:e=>{e.exports=require("node:crypto")},62997:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>w,patchFetch:()=>C,requestAsyncStorage:()=>q,routeModule:()=>g,serverHooks:()=>v,staticGenerationAsyncStorage:()=>I});var s={};r.r(s),r.d(s,{GET:()=>A});var o=r(49303),i=r(88716),n=r(60670),a=r(87070),p=r(24263),d=r(11185),u=r.n(d),c=r(22298),l=r(58567),m=r(5161),h=r(92491);let f=process.env.MONGODB_URI||process.env.NEXT_PUBLIC_MONGODB_URI||"mongodb://localhost:27017/polydropbox";u().connections[0].readyState||u().connect(f);let x=new(u()).Schema({orderId:{type:String,required:!0,unique:!0},fileId:{type:String,required:!0},payer:String,depositAddress:String,depositAmount:String,settleAmount:String,inputAsset:String,outputAsset:String,status:{type:String,default:"pending"},createdAt:{type:Date,default:Date.now},completedAt:Date}),y=u().models.SideShiftOrder||u().model("SideShiftOrder",x);async function S(e){try{return(await p.Z.get(`https://api.sideshift.ai/v2/shifts/${e}`,{headers:{"Content-Type":"application/json",...process.env.SIDESHIFT_SECRET&&{"x-sideshift-secret":process.env.SIDESHIFT_SECRET}}})).data}catch(e){throw console.error("SideShift status check error:",e.response?.data||e.message),e}}async function A(e,{params:t}){try{let{orderId:e}=t,r=await y.findOne({orderId:e});if(!r)return a.NextResponse.json({error:"Order not found"},{status:404});try{let t=await S(e);if(t.status!==r.status){if(r.status=t.status,"complete"===t.status){r.completedAt=new Date;let t=process.env.NEXT_PUBLIC_CONTRACT_ADDRESS,s=process.env.PRIVATE_KEY||process.env.NEXT_PUBLIC_PRIVATE_KEY;if(t&&s)try{let o=new c.r6("https://rpc-amoy.polygon.technology"),i=new l.w(s,o),n=new m.CH(t,["function recordCrossChainPayment(string memory fileId, address payer, uint256 amount)"],i),a=h.vz(r.settleAmount,6),p=await n.recordCrossChainPayment(r.fileId,r.payer,a);await p.wait(),console.log(`Payment recorded for file ${r.fileId}, order ${e}`)}catch(e){console.error("Blockchain error recording payment:",e)}}await r.save()}return a.NextResponse.json({status:t.status,depositAddress:t.depositAddress,depositAmount:t.depositAmount,settleAmount:t.settleAmount,completed:"complete"===t.status})}catch(e){return a.NextResponse.json({status:r.status,depositAddress:r.depositAddress,depositAmount:r.depositAmount,settleAmount:r.settleAmount,completed:"complete"===r.status})}}catch(e){return console.error("SideShift status check error:",e),a.NextResponse.json({error:"Failed to check order status",message:e.message},{status:500})}}let g=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/sideshift/status/[orderId]/route",pathname:"/api/sideshift/status/[orderId]",filename:"route",bundlePath:"app/api/sideshift/status/[orderId]/route"},resolvedPagePath:"C:\\Users\\BMSIT\\PolyDropBox\\frontend\\app\\api\\sideshift\\status\\[orderId]\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:q,staticGenerationAsyncStorage:I,serverHooks:v}=g,w="/api/sideshift/status/[orderId]/route";function C(){return(0,n.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:I})}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[948,972,263,900,491],()=>r(62997));module.exports=s})();