"use strict";(()=>{var e={};e.id=610,e.ids=[610],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},32694:e=>{e.exports=require("http2")},35240:e=>{e.exports=require("https")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},76162:e=>{e.exports=require("stream")},74175:e=>{e.exports=require("tty")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},4810:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>I,patchFetch:()=>v,requestAsyncStorage:()=>A,routeModule:()=>y,serverHooks:()=>w,staticGenerationAsyncStorage:()=>C});var s={};r.r(s),r.d(s,{POST:()=>q});var o=r(49303),i=r(88716),a=r(60670),n=r(87070),d=r(24263),p=r(11185),u=r.n(p);let l=process.env.MONGODB_URI||process.env.NEXT_PUBLIC_MONGODB_URI||"mongodb://localhost:27017/polydropbox";u().connections[0].readyState||u().connect(l);let c=new(u()).Schema({fileId:{type:String,required:!0,unique:!0},fileName:String,fileSize:Number,ipfsHash:String,encryptedKey:String,creator:String,price:Number,expiryTime:Number,maxDownloads:Number,downloadCount:{type:Number,default:0},burnAfterDownload:Boolean,enableCrossChain:Boolean,createdAt:{type:Date,default:Date.now}}),S=new(u()).Schema({orderId:{type:String,required:!0,unique:!0},fileId:{type:String,required:!0},payer:String,depositAddress:String,depositAmount:String,settleAmount:String,inputAsset:String,outputAsset:String,status:{type:String,default:"pending"},createdAt:{type:Date,default:Date.now},completedAt:Date}),h=u().models.File||u().model("File",c),m=u().models.SideShiftOrder||u().model("SideShiftOrder",S),f={BTC:"btc",ETH:"eth",SOL:"sol",BNB:"bnb",LTC:"ltc",USDC:"usdc"};async function x(e,t,r,s){try{let o=f[e.toUpperCase()]||e.toLowerCase(),i=`${f[t.toUpperCase()]||t.toLowerCase()}-${r.toLowerCase()}`;return(await d.Z.post("https://api.sideshift.ai/v2/quotes",{depositMethodId:o,settleMethodId:i,depositAmount:parseFloat(s).toFixed(6)},{headers:{"Content-Type":"application/json",...process.env.SIDESHIFT_SECRET&&{"x-sideshift-secret":process.env.SIDESHIFT_SECRET}}})).data}catch(e){throw console.error("SideShift quote error:",e.response?.data||e.message),Error(`SideShift quote failed: ${e.response?.data?.message||e.message}`)}}async function g(e,t,r,s,o){try{let i=await x(e,t,r,o);if(!i.id)throw Error("Invalid quote response");let a=f[e.toUpperCase()]||e.toLowerCase(),n=`${f[t.toUpperCase()]||t.toLowerCase()}-${r.toLowerCase()}`;return(await d.Z.post("https://api.sideshift.ai/v2/shifts/fixed",{quoteId:i.id,depositMethodId:a,settleMethodId:n,settleAddress:s},{headers:{"Content-Type":"application/json",...process.env.SIDESHIFT_SECRET&&{"x-sideshift-secret":process.env.SIDESHIFT_SECRET}}})).data}catch(e){throw console.error("SideShift API error:",e.response?.data||e.message),Error(`SideShift order creation failed: ${e.response?.data?.message||e.message}`)}}async function q(e){try{let{fileId:t,inputAsset:r,outputAsset:s,outputNetwork:o,outputAddress:i,amount:a,payer:d}=await e.json(),p=await h.findOne({fileId:t});if(!p)return n.NextResponse.json({error:"File not found"},{status:404});if(!p.enableCrossChain)return n.NextResponse.json({error:"Cross-chain payments not enabled for this file"},{status:400});let u=await g(r,s,o,i,a),l=new m({orderId:u.id,fileId:t,payer:d||"unknown",depositAddress:u.depositAddress||u.deposit?.address,depositAmount:(u.depositAmount||u.deposit?.amount||a).toString(),settleAmount:(u.settleAmount||u.settle?.amount||a).toString(),inputAsset:r,outputAsset:s,status:u.status||"pending"});return await l.save(),n.NextResponse.json({success:!0,orderId:u.id,depositAddress:u.depositAddress||u.deposit?.address,depositAmount:u.depositAmount||u.deposit?.amount||a,settleAmount:u.settleAmount||u.settle?.amount||a,inputAsset:r,outputAsset:s,expiry:u.expiresAt||u.expires||null,status:u.status||"pending"})}catch(e){return console.error("SideShift create error:",e),n.NextResponse.json({error:"Failed to create SideShift order",message:e.message},{status:500})}}let y=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/sideshift/create/route",pathname:"/api/sideshift/create",filename:"route",bundlePath:"app/api/sideshift/create/route"},resolvedPagePath:"C:\\Users\\BMSIT\\PolyDropBox\\frontend\\app\\api\\sideshift\\create\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:A,staticGenerationAsyncStorage:C,serverHooks:w}=y,I="/api/sideshift/create/route";function v(){return(0,a.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:C})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[948,972,263],()=>r(4810));module.exports=s})();