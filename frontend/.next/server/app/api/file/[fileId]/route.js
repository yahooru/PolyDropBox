"use strict";(()=>{var e={};e.id=526,e.ids=[526],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},19806:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>v,patchFetch:()=>w,requestAsyncStorage:()=>h,routeModule:()=>f,serverHooks:()=>m,staticGenerationAsyncStorage:()=>x});var s={};t.r(s),t.d(s,{GET:()=>d,POST:()=>c});var o=t(49303),n=t(88716),i=t(60670),a=t(87070),u=t(84770),l=t.n(u),p=t(9487);async function d(e,{params:r}){try{let{fileId:e}=r,t=await p.$.findOne({fileId:e});if(!t)return a.NextResponse.json({error:"File not found"},{status:404});let s=!!t.sharePasswordHash;if(t.linkExpiresAt&&Date.now()/1e3>t.linkExpiresAt)return a.NextResponse.json({error:"This share link has expired"},{status:410});return a.NextResponse.json({file:{...t.toObject(),sharePasswordHash:void 0,encryptedKey:void 0,hasPassword:s,hasPreview:!!t.previewHash}})}catch(e){return console.error("Get file error:",e),a.NextResponse.json({error:"Failed to fetch file"},{status:500})}}async function c(e,{params:r}){try{let{fileId:s}=r,{action:o,password:n}=await e.json();if("verify-password"===o){var t;let e=await p.$.findOne({fileId:s});if(!e)return a.NextResponse.json({error:"File not found"},{status:404});if(!e.sharePasswordHash)return a.NextResponse.json({valid:!0});let r=n&&(t=e.sharePasswordHash,l().createHash("sha256").update(n).digest("hex")===t);return a.NextResponse.json({valid:!!r})}return a.NextResponse.json({error:"Invalid action"},{status:400})}catch(e){return console.error("File action error:",e),a.NextResponse.json({error:"Failed to process request"},{status:500})}}(0,p.u)();let f=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/file/[fileId]/route",pathname:"/api/file/[fileId]",filename:"route",bundlePath:"app/api/file/[fileId]/route"},resolvedPagePath:"C:\\Users\\BMSIT\\PolyDropBox\\frontend\\app\\api\\file\\[fileId]\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:h,staticGenerationAsyncStorage:x,serverHooks:m}=f,v="/api/file/[fileId]/route";function w(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:x})}},9487:(e,r,t)=>{t.d(r,{$:()=>u,u:()=>i});var s=t(11185),o=t.n(s);let n=process.env.MONGODB_URI||process.env.NEXT_PUBLIC_MONGODB_URI||"mongodb://localhost:27017/polydropbox";function i(){o().connections[0]?.readyState||o().connect(n)}let a=new(o()).Schema({fileId:{type:String,required:!0,unique:!0},fileName:String,fileSize:Number,ipfsHash:String,encryptedKey:String,creator:String,price:Number,expiryTime:Number,maxDownloads:Number,downloadCount:{type:Number,default:0},burnAfterDownload:Boolean,enableCrossChain:Boolean,createdAt:{type:Date,default:Date.now},previewHash:String,sharePasswordHash:String,linkExpiresAt:Number,mimeType:String,downloads:[{user:String,timestamp:Date,txHash:String}]}),u=o().models.File||o().model("File",a)}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[948,972],()=>t(19806));module.exports=s})();