"use strict";(()=>{var e={};e.id=374,e.ids=[374],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},32694:e=>{e.exports=require("http2")},35240:e=>{e.exports=require("https")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},76162:e=>{e.exports=require("stream")},74175:e=>{e.exports=require("tty")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},62563:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>h,patchFetch:()=>f,requestAsyncStorage:()=>c,routeModule:()=>d,serverHooks:()=>x,staticGenerationAsyncStorage:()=>m});var i={};t.r(i),t.d(i,{GET:()=>l});var o=t(49303),a=t(88716),s=t(60670),n=t(87070),p=t(24263),u=t(9487);async function l(e,{params:r}){try{let{fileId:e}=r,t=await u.$.findOne({fileId:e});if(!t||!t.previewHash)return n.NextResponse.json({error:"Preview not available"},{status:404});let i=await p.Z.get(`https://gateway.pinata.cloud/ipfs/${t.previewHash}`,{responseType:"arraybuffer"}),o=t.mimeType?.startsWith("image/")?"image/png":"application/pdf";return new n.NextResponse(i.data,{headers:{"Content-Type":o,"Cache-Control":"public, max-age=86400"}})}catch(e){return console.error("Preview error:",e),n.NextResponse.json({error:"Preview unavailable"},{status:500})}}(0,u.u)();let d=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/preview/[fileId]/route",pathname:"/api/preview/[fileId]",filename:"route",bundlePath:"app/api/preview/[fileId]/route"},resolvedPagePath:"C:\\Users\\BMSIT\\PolyDropBox\\frontend\\app\\api\\preview\\[fileId]\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:c,staticGenerationAsyncStorage:m,serverHooks:x}=d,h="/api/preview/[fileId]/route";function f(){return(0,s.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:m})}},9487:(e,r,t)=>{t.d(r,{$:()=>p,u:()=>s});var i=t(11185),o=t.n(i);let a=process.env.MONGODB_URI||process.env.NEXT_PUBLIC_MONGODB_URI||"mongodb://localhost:27017/polydropbox";function s(){o().connections[0]?.readyState||o().connect(a)}let n=new(o()).Schema({fileId:{type:String,required:!0,unique:!0},fileName:String,fileSize:Number,ipfsHash:String,encryptedKey:String,creator:String,price:Number,expiryTime:Number,maxDownloads:Number,downloadCount:{type:Number,default:0},burnAfterDownload:Boolean,enableCrossChain:Boolean,createdAt:{type:Date,default:Date.now},previewHash:String,sharePasswordHash:String,linkExpiresAt:Number,mimeType:String,downloads:[{user:String,timestamp:Date,txHash:String}]}),p=o().models.File||o().model("File",n)}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),i=r.X(0,[948,972,263],()=>t(62563));module.exports=i})();