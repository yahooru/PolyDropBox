(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[928],{7883:function(e,t,a){Promise.resolve().then(a.bind(a,4454))},4454:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return f}});var s=a(7437),r=a(2265),i=a(9376),n=a(3662),l=a(4189),d=a(8399),o=a(6574),c=a(9502),x=a(7303),m=a(3464),p=a(166),u=a(2611),h=a(257);let b=(0,p.default)(()=>a.e(398).then(a.bind(a,5398)).then(e=>e.QRCodeSVG),{loadableGenerated:{webpack:()=>[null]},ssr:!1}),y=[{inputs:[{name:"fileId",type:"string"}],name:"payForAccess",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{name:"fileId",type:"string"},{name:"user",type:"address"}],name:"hasAccess",outputs:[{name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{name:"fileId",type:"string"}],name:"getFile",outputs:[{name:"ipfsHash",type:"string"},{name:"creator",type:"address"},{name:"price",type:"uint256"},{name:"expiryTime",type:"uint256"},{name:"maxDownloads",type:"uint256"},{name:"downloadCount",type:"uint256"},{name:"burnAfterDownload",type:"bool"},{name:"isActive",type:"bool"},{name:"createdAt",type:"uint256"}],stateMutability:"view",type:"function"}],g=[{inputs:[{name:"spender",type:"address"},{name:"amount",type:"uint256"}],name:"approve",outputs:[{name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"}];function f(){let e=(0,i.useParams)().fileId,{address:t,isConnected:a}=(0,n.m)(),[p,f]=(0,r.useState)(null),[v,w]=(0,r.useState)(!1),[j,N]=(0,r.useState)(""),[D,C]=(0,r.useState)(""),[k,S]=(0,r.useState)(null),[A,P]=(0,r.useState)(null),[E,T]=(0,r.useState)("pending"),[L,F]=(0,r.useState)(!1),[I,U]=(0,r.useState)("BTC"),[B,_]=(0,r.useState)(!1),O=h.env.NEXT_PUBLIC_CONTRACT_ADDRESS,R=h.env.NEXT_PUBLIC_USDC_ADDRESS,{data:Z}=(0,l.u)({address:O,abi:y,functionName:"getFile",args:[e],query:{enabled:!!e&&!!O}}),{data:q}=(0,l.u)({address:O,abi:y,functionName:"hasAccess",args:[e,t||"0x"],query:{enabled:!!e&&!!t&&!!O}}),{writeContract:M,data:W}=(0,d.S)(),{writeContract:z,data:G}=(0,d.S)(),{isLoading:H}=(0,o.A)({hash:W}),{isLoading:V}=(0,o.A)({hash:G});(0,r.useEffect)(()=>{if(Z){let[e,t,a,s,r,i,n,l,d]=Z;S({ipfsHash:e,creator:t,price:(0,c.b)(a,6),expiryTime:Number(s),maxDownloads:Number(r),downloadCount:Number(i),burnAfterDownload:n,isActive:l,createdAt:Number(d)})}},[Z]),(0,r.useEffect)(()=>{e&&m.Z.get("/api/file/".concat(e)).then(e=>{if(e.data.file){let t=e.data.file;f({fileName:t.fileName||"Unknown File",hasPassword:t.hasPassword||!1,hasPreview:t.hasPreview||!1,linkExpired:!!t.linkExpiresAt&&Date.now()/1e3>t.linkExpiresAt,mimeType:t.mimeType})}}).catch(e=>{var t;(null===(t=e.response)||void 0===t?void 0:t.status)===410?f({fileName:"",hasPassword:!1,hasPreview:!1,linkExpired:!0}):f({fileName:"Unknown",hasPassword:!1,hasPreview:!1})})},[e]),(0,r.useEffect)(()=>{if(!(null==A?void 0:A.orderId)||"complete"===E)return;_(!0);let e=setInterval(async()=>{try{let t=await m.Z.get("/api/sideshift/status/".concat(A.orderId));T(t.data.status),t.data.completed&&(_(!1),clearInterval(e),setTimeout(()=>window.location.reload(),2e3))}catch(e){console.error(e)}},5e3);return()=>{clearInterval(e),_(!1)}},[null==A?void 0:A.orderId,E]);let X=async()=>{C("");try{(await m.Z.post("/api/file/".concat(e),{action:"verify-password",password:j})).data.valid?w(!0):C("Incorrect password")}catch(e){C("Verification failed")}},Y=async()=>{k&&t&&M({address:R,abi:g,functionName:"approve",args:[O,(0,x.v)(k.price,6)]})};(0,r.useEffect)(()=>{W&&!H&&z({address:O,abi:y,functionName:"payForAccess",args:[e]})},[W,H]);let K=async()=>{if(t&&k)try{let a=await m.Z.post("/api/sideshift/create",{fileId:e,inputAsset:I,outputAsset:"USDC",outputNetwork:"POLYGON",outputAddress:O,amount:k.price,payer:t});if(a.data.success)P(a.data),T("pending");else throw Error("Failed")}catch(e){var a,s;alert((null===(s=e.response)||void 0===s?void 0:null===(a=s.data)||void 0===a?void 0:a.error)||"Failed to create SideShift order")}},Q=async()=>{if(q&&t)try{let a=await m.Z.post("/api/download",{fileId:e,user:t},{responseType:"blob"}),s=window.URL.createObjectURL(new Blob([a.data])),r=document.createElement("a");r.href=s,r.download=(null==p?void 0:p.fileName)||"download",r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(s)}catch(e){alert("Download failed")}};if(!k)return(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-white to-primary-50/30 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-500 mx-auto"}),(0,s.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading file..."})]})});let $=(null==p?void 0:p.hasPassword)&&!v,J=null==p?void 0:p.linkExpired,ee=Date.now()/1e3>k.expiryTime,et=q&&!ee&&k.isActive;return J?(0,s.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-white to-primary-50/30",children:[(0,s.jsx)(u.w,{}),(0,s.jsx)("div",{className:"max-w-2xl mx-auto px-4 py-2 flex items-center justify-center min-h-[60vh]",children:(0,s.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-8 text-center border border-red-100",children:[(0,s.jsx)("div",{className:"text-5xl mb-4",children:"\uD83D\uDD12"}),(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Link Expired"}),(0,s.jsx)("p",{className:"text-gray-600",children:"This share link has expired and is no longer accessible."})]})})]}):$?(0,s.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-white to-primary-50/30",children:[(0,s.jsx)(u.w,{}),(0,s.jsx)("div",{className:"max-w-md mx-auto px-4 py-2 flex items-center justify-center min-h-[60vh]",children:(0,s.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-8 text-center border border-primary-100",children:[(0,s.jsx)("div",{className:"text-5xl mb-4",children:"\uD83D\uDD10"}),(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Password Required"}),(0,s.jsx)("p",{className:"text-gray-600 mb-4",children:"Enter the password to view this file"}),(0,s.jsx)("input",{type:"password",value:j,onChange:e=>N(e.target.value),onKeyDown:e=>"Enter"===e.key&&X(),placeholder:"Enter password",className:"w-full px-4 py-3 border rounded-lg mb-4"}),D&&(0,s.jsx)("p",{className:"text-red-600 text-sm mb-2",children:D}),(0,s.jsx)("button",{onClick:X,className:"w-full px-6 py-3 bg-primary-500 text-white rounded-lg hover:bg-primary-600 font-semibold",children:"Unlock"})]})})]}):(0,s.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-white to-primary-50/30",children:[(0,s.jsx)(u.w,{}),(0,s.jsx)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:(0,s.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-8 border border-gray-100",children:[(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:(null==p?void 0:p.fileName)||"File Access"}),(0,s.jsxs)("p",{className:"text-sm text-gray-500 font-mono",children:["ID: ",e]})]}),(null==p?void 0:p.hasPreview)&&!et&&(0,s.jsxs)("div",{className:"mb-8 rounded-xl overflow-hidden border border-gray-200 bg-gray-50",children:[(0,s.jsx)("div",{className:"p-3 bg-gray-100 border-b text-sm font-medium text-gray-700",children:"\uD83D\uDD0D Preview (before purchase)"}),(0,s.jsx)("div",{className:"p-4 flex justify-center items-center min-h-[280px]",children:"application/pdf"===p.mimeType?(0,s.jsx)("iframe",{src:"/api/preview/".concat(e),className:"w-full h-[320px] rounded-lg border-0",title:"PDF Preview"}):(0,s.jsxs)("div",{className:"relative inline-block",children:[(0,s.jsx)("img",{src:"/api/preview/".concat(e),alt:"Blurred preview",className:"max-h-[400px] rounded-lg object-contain"}),(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:(0,s.jsx)("span",{className:"bg-black/40 rounded-full p-3 text-white text-2xl",children:"\uD83D\uDD12"})})]})})]}),(0,s.jsxs)("div",{className:"grid md:grid-cols-2 gap-4 mb-8",children:[(0,s.jsxs)("div",{className:"bg-primary-50 p-4 rounded-xl",children:[(0,s.jsx)("span",{className:"text-sm text-gray-600 block mb-1",children:"Price"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-primary-600",children:"0.0"===k.price?"Free":"".concat(k.price," USDC")})]}),(0,s.jsxs)("div",{className:"bg-gray-50 p-4 rounded-xl",children:[(0,s.jsx)("span",{className:"text-sm text-gray-600 block mb-1",children:"Status"}),(0,s.jsx)("p",{className:"text-lg font-semibold ".concat(ee?"text-red-600":k.isActive?"text-green-600":"text-gray-600"),children:ee?"Expired":k.isActive?"Active":"Inactive"})]}),(0,s.jsxs)("div",{className:"bg-gray-50 p-4 rounded-xl",children:[(0,s.jsx)("span",{className:"text-sm text-gray-600 block mb-1",children:"Expires"}),(0,s.jsx)("p",{className:ee?"text-red-600 font-semibold":"text-gray-900",children:new Date(1e3*k.expiryTime).toLocaleString()})]}),(0,s.jsxs)("div",{className:"bg-gray-50 p-4 rounded-xl",children:[(0,s.jsx)("span",{className:"text-sm text-gray-600 block mb-1",children:"Downloads"}),(0,s.jsxs)("p",{className:"text-lg font-semibold text-gray-900",children:[k.downloadCount," / ",k.maxDownloads]})]})]}),k.burnAfterDownload&&(0,s.jsx)("div",{className:"mb-6 p-3 bg-yellow-50 border border-yellow-200 rounded-xl",children:(0,s.jsx)("p",{className:"text-sm text-yellow-800",children:"⚠️ This file will be permanently deleted after download"})}),a?et?(0,s.jsx)("div",{className:"text-center py-8",children:(0,s.jsx)("button",{onClick:Q,className:"px-8 py-3 bg-primary-500 text-white rounded-xl hover:bg-primary-600 transition font-semibold text-lg shadow-lg",children:"Download File"})}):"0.0"===k.price?(0,s.jsx)("div",{className:"text-center py-8",children:(0,s.jsx)("button",{onClick:Q,className:"px-8 py-3 bg-primary-500 text-white rounded-xl hover:bg-primary-600 transition font-semibold text-lg",children:"Download File (Free)"})}):(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex space-x-4",children:[(0,s.jsx)("button",{onClick:()=>F(!1),className:"flex-1 px-4 py-2 rounded-xl transition ".concat(L?"bg-gray-200 text-gray-700":"bg-primary-500 text-white"),children:"Pay on Polygon"}),(0,s.jsx)("button",{onClick:()=>F(!0),className:"flex-1 px-4 py-2 rounded-xl transition ".concat(L?"bg-primary-500 text-white":"bg-gray-200 text-gray-700"),children:"Pay with Any Crypto"})]}),L?(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("select",{value:I,onChange:e=>U(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-xl",children:[(0,s.jsx)("option",{value:"BTC",children:"Bitcoin (BTC)"}),(0,s.jsx)("option",{value:"ETH",children:"Ethereum (ETH)"}),(0,s.jsx)("option",{value:"SOL",children:"Solana (SOL)"}),(0,s.jsx)("option",{value:"BNB",children:"BNB"}),(0,s.jsx)("option",{value:"LTC",children:"Litecoin (LTC)"})]}),(0,s.jsx)("button",{onClick:K,disabled:!k||!t,className:"w-full px-6 py-3 bg-primary-500 text-white rounded-xl hover:bg-primary-600 transition font-semibold disabled:opacity-50",children:A?"Create New Payment":"Create Payment Link"}),A&&(0,s.jsxs)("div",{className:"mt-6 p-6 bg-primary-50 rounded-xl border-2 border-primary-200",children:[(0,s.jsxs)("div",{className:"text-center mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"complete"===E?"✅ Payment Received!":"Send Payment"}),"pending"===E&&B&&(0,s.jsxs)("div",{className:"flex items-center justify-center space-x-2 text-primary-600",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary-600"}),(0,s.jsx)("span",{className:"text-sm",children:"Waiting for payment confirmation..."})]})]}),"complete"!==E&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"bg-white p-4 rounded-lg mb-4",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"Send exactly:"}),(0,s.jsxs)("p",{className:"text-xl font-bold text-primary-600 mb-3",children:[A.depositAmount," ",I]}),(0,s.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:"To this address:"}),(0,s.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,s.jsx)("p",{className:"font-mono text-sm break-all flex-1 bg-gray-100 p-2 rounded",children:A.depositAddress}),(0,s.jsx)("button",{onClick:()=>{navigator.clipboard.writeText(A.depositAddress),alert("Address copied!")},className:"px-3 py-2 bg-primary-500 text-white rounded hover:bg-primary-600 text-sm",children:"Copy"})]})]}),(0,s.jsx)("div",{className:"flex justify-center mb-4",children:(0,s.jsx)("div",{className:"bg-white p-4 rounded-lg",children:(0,s.jsx)(b,{value:A.depositAddress,size:200})})}),(0,s.jsxs)("div",{className:"bg-blue-50 p-3 rounded-lg",children:[(0,s.jsxs)("p",{className:"text-xs text-blue-800 text-center",children:["\uD83D\uDCA1 After sending, payment will be automatically converted to ",A.settleAmount," USDC on Polygon"]}),(0,s.jsx)("p",{className:"text-xs text-blue-600 text-center mt-1",children:"This page will automatically refresh when payment is confirmed"})]})]}),"complete"===E&&(0,s.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg text-center",children:[(0,s.jsx)("p",{className:"text-green-800 font-semibold mb-2",children:"Payment confirmed! You can now download the file."}),(0,s.jsx)("button",{onClick:Q,className:"px-6 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition font-semibold",children:"Download File"})]})]})]}):(0,s.jsx)("button",{onClick:Y,disabled:H||V,className:"w-full px-6 py-3 bg-primary-500 text-white rounded-xl hover:bg-primary-600 transition disabled:opacity-50 font-semibold",children:H||V?"Processing...":"Pay ".concat(k.price," USDC")})]}):(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)("p",{className:"text-gray-600 mb-4",children:"Connect wallet to access file"}),(0,s.jsx)("button",{onClick:()=>window.location.reload(),className:"px-6 py-3 bg-primary-500 text-white rounded-xl hover:bg-primary-600 transition",children:"Connect Wallet"})]}),(0,s.jsxs)("div",{className:"mt-8 pt-8 border-t border-gray-200",children:[(0,s.jsx)("p",{className:"text-sm text-gray-500 mb-2",children:"Share this link:"}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("input",{type:"text",readOnly:!0,value:"".concat(window.location.origin,"/file/").concat(e),className:"flex-1 px-4 py-2 border border-gray-300 rounded-xl font-mono text-sm"}),(0,s.jsx)("button",{onClick:()=>{navigator.clipboard.writeText("".concat(window.location.origin,"/file/").concat(e)),alert("Link copied!")},className:"px-4 py-2 bg-primary-500 text-white rounded-xl hover:bg-primary-600 transition",children:"Copy"})]})]})]})})]})}},2611:function(e,t,a){"use strict";a.d(t,{w:function(){return d}});var s=a(7437),r=a(2265),i=a(7648),n=a(3662),l=a(6518);function d(){let{address:e,isConnected:t}=(0,n.m)(),[a,d]=(0,r.useState)(!1);return((0,r.useEffect)(()=>{d(!0)},[]),a)?(0,s.jsx)("nav",{className:"bg-white/80 backdrop-blur-sm border-b border-primary-200 sticky top-0 z-50",children:(0,s.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"flex justify-between items-center h-16",children:[(0,s.jsxs)(i.default,{href:"/",className:"flex items-center space-x-3 hover:opacity-80 transition",children:[(0,s.jsx)("div",{className:"h-10 w-10 rounded-lg bg-gradient-to-br from-primary-400 to-primary-600 flex items-center justify-center text-white text-2xl",children:"\uD83D\uDCE6"}),(0,s.jsx)("h1",{className:"text-2xl font-bold text-primary-600",children:"PolyDropBox"})]}),(0,s.jsx)("div",{className:"flex items-center space-x-4",children:t?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.default,{href:"/upload",className:"px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition",children:"Upload"}),(0,s.jsx)(i.default,{href:"/dashboard",className:"px-4 py-2 text-primary-600 hover:text-primary-700",children:"Dashboard"}),(0,s.jsxs)("div",{className:"px-4 py-2 bg-primary-100 text-primary-700 rounded-lg text-sm",children:[null==e?void 0:e.slice(0,6),"...",null==e?void 0:e.slice(-4)]})]}):(0,s.jsx)(l.T,{})})]})})}):(0,s.jsx)("nav",{className:"bg-white/80 backdrop-blur-sm border-b border-primary-200 sticky top-0 z-50",children:(0,s.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"flex justify-between items-center h-16",children:[(0,s.jsxs)(i.default,{href:"/",className:"flex items-center space-x-3 hover:opacity-80 transition",children:[(0,s.jsx)("div",{className:"h-10 w-10 rounded-lg bg-gradient-to-br from-primary-400 to-primary-600 flex items-center justify-center text-white text-2xl",children:"\uD83D\uDCE6"}),(0,s.jsx)("h1",{className:"text-2xl font-bold text-primary-600",children:"PolyDropBox"})]}),(0,s.jsx)("div",{className:"flex items-center space-x-4",children:(0,s.jsx)(l.T,{})})]})})})}},6518:function(e,t,a){"use strict";a.d(t,{T:function(){return o}});var s=a(7437),r=a(2265),i=a(3662),n=a(542),l=a(9778),d=a(9726);function o(){let{address:e,isConnected:t}=(0,i.m)(),{connect:a}=(0,n.$)(),{disconnect:o}=(0,l.q)(),[c,x]=(0,r.useState)(!1);return((0,r.useEffect)(()=>{x(!0)},[]),c)?t&&e?(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsxs)("div",{className:"px-4 py-2 bg-primary-100 text-primary-700 rounded-lg text-sm",children:[e.slice(0,6),"...",e.slice(-4)]}),(0,s.jsx)("button",{onClick:()=>o(),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition text-sm",children:"Disconnect"})]}):(0,s.jsx)("button",{onClick:()=>a({connector:(0,d.L)()}),className:"px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition",children:"Connect Wallet"}):(0,s.jsx)("button",{className:"px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition",disabled:!0,children:"Connect Wallet"})}}},function(e){e.O(0,[432,3,464,903,794,971,117,744],function(){return e(e.s=7883)}),_N_E=e.O()}]);